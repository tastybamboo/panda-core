#!/usr/bin/env bash
# Compile Panda Core CSS with all content (Core + CMS)
#
# Usage:
#   bin/compile-css           # Compile with default paths
#   bin/compile-css --watch   # Compile and watch for changes (not yet supported)

set -e

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}üêº Compiling Panda Core CSS...${NC}"

# Check if we're in the core directory
if [ ! -f "lib/panda/core/version.rb" ]; then
  echo -e "${YELLOW}‚ö†Ô∏è  Not in panda-core directory. Please run from Core root.${NC}"
  exit 1
fi

# Check if CMS exists in sibling directory
if [ ! -d "../cms" ]; then
  echo -e "${YELLOW}‚ö†Ô∏è  CMS directory not found at ../cms${NC}"
  echo -e "${YELLOW}   Compiling with Core content only (will be smaller ~14KB)${NC}"
  echo ""

  bundle exec tailwindcss \
    -i app/assets/tailwind/application.css \
    -o public/panda-core-assets/panda-core.css \
    --minify
else
  echo -e "${GREEN}‚úì Found CMS directory, compiling full CSS${NC}"
  echo ""

  bundle exec tailwindcss \
    -i app/assets/tailwind/application.css \
    -o public/panda-core-assets/panda-core.css \
    --content '../cms/app/views/**/*.erb' \
    --content '../cms/app/components/**/*.rb' \
    --content '../cms/app/javascript/**/*.js' \
    --content 'app/views/**/*.erb' \
    --content 'app/components/**/*.rb' \
    --minify
fi

# Check output file size
FILE_SIZE=$(ls -lh public/panda-core-assets/panda-core.css | awk '{print $5}')
echo ""
echo -e "${GREEN}‚úÖ CSS compiled: public/panda-core-assets/panda-core.css${NC}"
echo -e "${BLUE}üì¶ File size: ${FILE_SIZE}${NC}"

if [ -d "../cms" ]; then
  echo ""
  echo -e "${YELLOW}üí° Expected size: ~37KB (Core + CMS)${NC}"
  echo -e "${YELLOW}   If smaller, check that CMS paths are accessible${NC}"
fi

echo ""
echo -e "${BLUE}üîÑ Restart your server to see changes${NC}"
