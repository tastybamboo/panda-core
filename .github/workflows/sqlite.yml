# compatibility-matrix-sqlite:
#   name: 'SQLite (Rails ${{ matrix.rails }}, Ruby ${{ matrix.ruby }})'
#   needs: smoke-test # Gate on smoke test success
#   runs-on: 'ubuntu-latest'
#   continue-on-error: true

#   strategy:
#     fail-fast: false
#     matrix:
#       # Test SQLite with latest Rails/Ruby only
#       ruby: ['3.4']
#       rails: ['8.1.1']

#   container:
#     image: ghcr.io/tastybamboo/panda-ci:ruby-${{ matrix.ruby }}-rails-${{ matrix.rails }}
#     options: --shm-size=2gb

#   permissions:
#     contents: read
#     pull-requests: write
#     checks: write

#   env:
#     BUNDLE_PATH: 'vendor/bundle'
#     RAILS_ENV: test
#     DISPLAY: ':99'
#     RAILS_VERSION: ${{ matrix.rails }}
#     DATABASE_ADAPTER: 'sqlite'

#   steps:
#     - uses: 'actions/checkout@v5'

#     - name: 'Update VERSION'
#       env:
#         VERSION: ${{ github.event.pull_request.head.sha }}
#       run: |
#         echo "${VERSION}" >> VERSION

#     - name: 'Start xvfb'
#       run: |
#         Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

#     # Since Docker images have gems pre-installed, we only need minimal setup
#     - name: 'Bundle install (main gem)'
#       run: |
#         bundle config without development
#         bundle install --jobs 4 --retry 3

#     #
#     # ğŸ§© IMPORTANT: Run database migrations BEFORE panda-assets-verify-action,
#     # because the asset pipeline loads Rails, and Rails loads ActiveRecord,
#     # and the dummy app's schema must exist before that happens.
#     #
#     - name: 'Setup test database'
#       env:
#         DATABASE_URL: 'sqlite3:db/test.sqlite3'
#         RAILS_ENV: test
#       run: |
#         echo "ğŸ—„ï¸ Setting up database..."
#         bundle exec rails db:schema:load
#         echo "âœ… Database ready"

#     #
#     # ğŸ¼ Run Panda Asset Verification
#     #
#     - name: Panda asset generation and verification
#       uses: tastybamboo/panda-assets-verify-action@v1
#       with:
#         dummy_root: spec/dummy
#         artifact_suffix: -ruby-${{ matrix.ruby }}-rails-${{ matrix.rails }}-sqlite

#     #
#     # ğŸ§ª Run application tests
#     #
#     - name: 'Run specs'
#       env:
#         DATABASE_URL: 'sqlite3:spec/dummy/db/test.sqlite3'
#         RAILS_ENV: 'test'
#         RSPEC_COLOR: 'true'
#         TERM: 'xterm-256color'
#       run: |
#         bundle exec rspec --format documentation --color

#     - name: 'Upload coverage'
#       uses: actions/upload-artifact@v5
#       if: always()
#       with:
#         name: coverage-${{ matrix.ruby }}-${{ matrix.rails }}-sqlite
#         path: coverage/

#     - name: Upload Capybara assets
#       uses: actions/upload-artifact@v5
#       if: always()
#       with:
#         name: capybara-${{ matrix.ruby }}-${{ matrix.rails }}-sqlite
#         path: spec/dummy/tmp/capybara/**/*
#         if-no-files-found: ignore
