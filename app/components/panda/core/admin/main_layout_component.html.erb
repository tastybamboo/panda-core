<%= render Panda::Core::Shared::HeaderComponent.new(html_class: "h-full", body_class: "") %>

<div class="flex h-full" id="panda-container">
  <div class="absolute top-0 w-full lg:flex lg:fixed lg:inset-y-0 lg:z-50 lg:flex-col lg:w-72">
    <div class="flex overflow-y-auto flex-col gap-y-5 px-4 pb-4 max-h-16 bg-gradient-admin lg:max-h-full grow" data-transition-enter="transition-all ease-in-out duration-300" data-transition-enter-from="m-h-16" data-transition-enter-to="max-h-full" data-transition-leave="transition-all ease-in-out duration-300" data-transition-leave-from="max-h-full" data-transition-leave-to="max-h-16">
      <%= render Panda::Core::Admin::SidebarComponent.new(user: @user) %>
    </div>
  </div>
  <div class="flex flex-col flex-1 mt-16 ml-0 lg:mt-0 lg:ml-72" id="panda-inner-container" <% if content_for :sidebar %> data-controller="toggle" data-action="keydown.esc@window->toggle#hide keydown.escape@window->toggle#hide" tabindex="-1"<% end %>>
    <section id="panda-main" class="flex flex-row h-full">
      <div class="flex-1 h-full overflow-y-auto" id="panda-primary-content">
        <%= render Panda::Core::Admin::BreadcrumbsComponent.new(breadcrumbs: @breadcrumbs) %>
        <%= render "panda/core/admin/shared/flash" %>
        <%= content %>
      </div>
      <% if content_for :sidebar %>
        <!-- Backdrop overlay -->
        <div data-toggle-target="toggleable" class="hidden fixed inset-0 bg-gray-500/75 transition-opacity duration-500 ease-in-out dark:bg-gray-900/50 z-40"
             data-transition-enter="transition-opacity duration-500 ease-in-out"
             data-transition-enter-from="opacity-0"
             data-transition-enter-to="opacity-100"
             data-transition-leave="transition-opacity duration-500 ease-in-out"
             data-transition-leave-from="opacity-100"
             data-transition-leave-to="opacity-0"></div>

        <!-- Slideover panel -->
        <div data-toggle-target="toggleable" class="hidden ml-auto block size-full max-w-md transform fixed right-0 top-0 h-full z-50"
              data-transition-enter="transform transition ease-in-out duration-500 sm:duration-700"
              data-transition-enter-from="translate-x-full"
              data-transition-enter-to="translate-x-0"
              data-transition-leave="transform transition ease-in-out duration-500 sm:duration-700"
              data-transition-leave-from="translate-x-0"
              data-transition-leave-to="translate-x-full"
              id="slideover">
          <div class="relative flex h-full flex-col bg-white shadow-xl dark:bg-gray-800 dark:after:absolute dark:after:inset-y-0 dark:after:left-0 dark:after:w-px dark:after:bg-white/10">
            <!-- Header -->
            <div class="bg-gradient-admin px-4 py-3 sm:px-6">
              <div class="flex items-center justify-between">
                <h2 class="text-base font-semibold text-white" id="slideover-title"><%= content_for?(:sidebar_title) ? yield(:sidebar_title) : "Sidebar" %></h2>
                <div class="ml-3 flex items-center">
                  <button type="button" data-action="click->toggle#toggle touch->toggle#toggle" class="flex items-center gap-x-1 rounded-full px-2 py-1 text-xs text-white/80 bg-white/10 hover:text-white hover:bg-white/20 transition-colors">
                    <span>Close</span>
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Content -->
            <% if content_for?(:sidebar) %>
              <div class="flex-1 overflow-y-auto">
                <%= yield :sidebar %>
              </div>
            <% end %>

            <!-- Footer (if present) -->
            <% if content_for?(:sidebar_footer) %>
              <div class="flex shrink-0 justify-end gap-x-3 border-t border-gray-200 px-4 py-4 dark:border-white/10">
                <%= yield :sidebar_footer %>
              </div>
            <% end %>
          </div>
        </div>
        <script>
          window.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
              document.querySelectorAll('[data-toggle-target="toggleable"]').forEach(function(el) {
                el.classList.add('hidden');
              });
            }
          });
        </script>
      <% end %>
    </section>
  </div>
</div>

<%= render Panda::Core::Shared::FooterComponent.new %>
