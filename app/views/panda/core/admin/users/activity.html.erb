<%= render Panda::Core::Admin::ContainerComponent.new do |component| %>
  <% component.with_heading_slot(text: "Activity: #{@user.name}", level: 1) do |heading| %>
    <% heading.with_button(text: "Back to User", href: admin_user_path(@user), icon: "fa-solid fa-arrow-left") %>
  <% end %>

  <% if @activities.any? %>
    <div class="flow-root">
      <ul class="-mb-8">
        <% @activities.each_with_index do |activity, index| %>
          <li>
            <div class="relative pb-8">
              <% unless index == @activities.length - 1 %>
                <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700" aria-hidden="true"></span>
              <% end %>
              <div class="relative flex space-x-3">
                <div>
                  <% icon_config = case activity.action
                     when "login"
                       {icon: "fa-solid fa-right-to-bracket", bg: "bg-green-500"}
                     when "logout"
                       {icon: "fa-solid fa-right-from-bracket", bg: "bg-gray-400"}
                     when "updated_user"
                       {icon: "fa-solid fa-user-pen", bg: "bg-blue-500"}
                     when "enabled_user"
                       {icon: "fa-solid fa-user-check", bg: "bg-green-500"}
                     when "disabled_user"
                       {icon: "fa-solid fa-user-slash", bg: "bg-red-500"}
                     when "invited_user"
                       {icon: "fa-solid fa-envelope", bg: "bg-purple-500"}
                     when "revoked_session"
                       {icon: "fa-solid fa-ban", bg: "bg-red-500"}
                     else
                       {icon: "fa-solid fa-circle-info", bg: "bg-gray-400"}
                     end %>
                  <span class="flex h-8 w-8 items-center justify-center rounded-full <%= icon_config[:bg] %> ring-8 ring-white dark:ring-gray-900">
                    <i class="<%= icon_config[:icon] %> text-white text-xs"></i>
                  </span>
                </div>
                <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                  <div>
                    <p class="text-sm text-gray-900 dark:text-white">
                      <strong><%= activity.action.humanize %></strong>
                      <% if activity.resource_type.present? %>
                        <span class="text-gray-500 dark:text-gray-400">
                          &mdash; <%= activity.resource_type.demodulize %>
                          <% if activity.resource_id.present? %>
                            (<%= activity.resource_id.to_s.first(8) %>...)
                          <% end %>
                        </span>
                      <% end %>
                    </p>
                    <% if activity.ip_address.present? %>
                      <p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">
                        IP: <%= activity.ip_address %>
                      </p>
                    <% end %>
                    <% if activity.metadata.present? && activity.metadata.any? %>
                      <div class="mt-1">
                        <% activity.metadata.each do |key, value| %>
                          <span class="inline-flex items-center rounded bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 text-xs text-gray-600 dark:text-gray-400 mr-1">
                            <%= key %>: <%= value %>
                          </span>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                  <div class="whitespace-nowrap text-right text-xs text-gray-500 dark:text-gray-400">
                    <time datetime="<%= activity.created_at.iso8601 %>"><%= time_ago_in_words(activity.created_at) %> ago</time>
                    <div class="text-gray-400 dark:text-gray-500"><%= activity.created_at.strftime("%b %d, %Y %H:%M") %></div>
                  </div>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>

    <%= render Panda::Core::Admin::PaginationComponent.new(
      page: @page, total_pages: @total_pages, total_count: @total_count,
      per_page: @per_page, item_name: "activities"
    ) %>
  <% else %>
    <%= render Panda::Core::Admin::EmptyStateComponent.new(
      icon: "fa-solid fa-clock-rotate-left",
      title: "No activity recorded",
      description: "Activity will appear here once this user starts using the system."
    ) %>
  <% end %>
<% end %>
