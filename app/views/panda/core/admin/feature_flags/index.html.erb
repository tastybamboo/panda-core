<%= render Panda::Core::Admin::ContainerComponent.new do |component| %>
  <% component.with_heading_slot(text: "Feature Flags", level: 1) %>

  <% if @feature_flags.any? %>
    <% @grouped_flags.each do |namespace, flags| %>
      <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-3 capitalize"><%= namespace.tr("_", " ") %></h2>

        <%= render Panda::Core::Admin::TableComponent.new(term: "feature flag", rows: flags, icon: "fa-solid fa-toggle-on") do |table| %>
          <% table.column("Flag", width: "35%") do |flag| %>
            <div>
              <div class="font-medium text-gray-900"><%= flag.key %></div>
              <% if flag.description.present? %>
                <div class="text-sm text-gray-500"><%= flag.description %></div>
              <% end %>
            </div>
          <% end %>

          <% table.column("Status", width: "20%") do |flag| %>
            <% if flag.enabled? %>
              <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">
                <i class="fa-solid fa-check mr-1"></i> Enabled
              </span>
            <% else %>
              <span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">
                <i class="fa-solid fa-xmark mr-1"></i> Disabled
              </span>
            <% end %>
          <% end %>

          <% table.column("Last Updated", width: "20%") do |flag| %>
            <span class="text-sm text-gray-500"><%= flag.updated_at.strftime("%d %b %Y %H:%M") %></span>
          <% end %>

          <% table.column("", width: "25%") do |flag| %>
            <div class="flex justify-end">
              <%= button_to admin_feature_flag_path(flag), method: :patch, class: "inline-flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition #{flag.enabled? ? 'text-red-600 hover:text-red-700 hover:bg-red-50' : 'text-green-600 hover:text-green-700 hover:bg-green-50'}" do %>
                <% if flag.enabled? %>
                  <i class="fa-solid fa-toggle-on"></i> Disable
                <% else %>
                  <i class="fa-solid fa-toggle-off"></i> Enable
                <% end %>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <div class="text-center py-12">
      <i class="fa-solid fa-toggle-off text-4xl text-gray-300 mb-3"></i>
      <p class="text-gray-500">No feature flags registered.</p>
      <p class="text-sm text-gray-400 mt-1">Feature flags are registered by application code during initialization.</p>
    </div>
  <% end %>
<% end %>
